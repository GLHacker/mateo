<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego: Piano MÃ¡gico</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            margin: 0;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            cursor: pointer;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 10;
        }
        .instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="instructions">Haz clic en las teclas para tocar</div>
    <div id="game-container"></div>
    <div class="controls">
        <a href="index.html" class="menu-button">Volver a Juegos</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('game-container');
            let scene, camera, renderer, raycaster, mouse;
            let keys = [];
            let audioContext, oscillator;

            function init() {
                // Scene & Camera
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf0f0f0);
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 8, 12);
                camera.lookAt(0, 0, 0);

                // Renderer
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 7.5);
                scene.add(directionalLight);

                // Raycaster
                raycaster = new THREE.Raycaster();
                mouse = new THREE.Vector2();

                // Piano Keys
                createPiano();

                // Audio Context
                container.addEventListener('click', initAudio);

                // Event Listeners
                container.addEventListener('mousedown', onMouseDown);
                window.addEventListener('resize', onWindowResize);

                animate();
            }

            function initAudio() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                container.removeEventListener('click', initAudio);
            }

            function createPiano() {
                const keyWidth = 2;
                const keyHeight = 1;
                const keyDepth = 8;
                const keyColors = [0xff0000, 0xffa500, 0xffff00, 0x00ff00, 0x0000ff, 0x4b0082, 0xee82ee];
                const frequencies = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88]; // C, D, E, F, G, A, B

                for (let i = 0; i < 7; i++) {
                    const geometry = new THREE.BoxGeometry(keyWidth, keyHeight, keyDepth);
                    const material = new THREE.MeshStandardMaterial({ color: keyColors[i] });
                    const key = new THREE.Mesh(geometry, material);

                    key.position.x = (i - 3) * (keyWidth + 0.2);
                    key.userData = {
                        originalColor: new THREE.Color(keyColors[i]),
                        frequency: frequencies[i]
                    };
                    keys.push(key);
                    scene.add(key);
                }
            }

            function playNote(key) {
                if (!audioContext) return;

                // Play sound
                oscillator = audioContext.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(key.userData.frequency, audioContext.currentTime);
                oscillator.connect(audioContext.destination);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3); // Play for 0.3 seconds

                // Visual feedback
                key.material.color.set(0xffffff); // Flash white
                key.position.y = -0.2;
                setTimeout(() => {
                    key.material.color.set(key.userData.originalColor);
                    key.position.y = 0;
                }, 200);
            }

            function onMouseDown(event) {
                const rect = renderer.domElement.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(keys);

                if (intersects.length > 0) {
                    playNote(intersects[0].object);
                }
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }

            init();
        });
    </script>
</body>
</html>